{"ast":null,"code":"const Constants = require('../util/Constants');\n\nconst Util = require('../util/Util');\n\nconst Guild = require('../structures/Guild');\n\nconst User = require('../structures/User');\n\nconst Emoji = require('../structures/Emoji');\n\nconst GuildChannel = require('../structures/GuildChannel');\n\nconst TextChannel = require('../structures/TextChannel');\n\nconst VoiceChannel = require('../structures/VoiceChannel');\n\nconst CategoryChannel = require('../structures/CategoryChannel');\n\nconst NewsChannel = require('../structures/NewsChannel');\n\nconst StoreChannel = require('../structures/StoreChannel');\n\nconst DMChannel = require('../structures/DMChannel');\n\nconst GroupDMChannel = require('../structures/GroupDMChannel');\n\nclass ClientDataManager {\n  constructor(client) {\n    this.client = client;\n  }\n\n  get pastReady() {\n    return this.client.ws.connection.status === Constants.Status.READY;\n  }\n\n  newGuild(data) {\n    const already = this.client.guilds.has(data.id);\n    const guild = new Guild(this.client, data);\n    this.client.guilds.set(guild.id, guild);\n\n    if (this.pastReady && !already) {\n      /**\n       * Emitted whenever the client joins a guild.\n       * @event Client#guildCreate\n       * @param {Guild} guild The created guild\n       */\n      if (this.client.options.fetchAllMembers) {\n        guild.fetchMembers().then(() => {\n          this.client.emit(Constants.Events.GUILD_CREATE, guild);\n        });\n      } else {\n        this.client.emit(Constants.Events.GUILD_CREATE, guild);\n      }\n    }\n\n    return guild;\n  }\n\n  newUser(data, cache = true) {\n    if (this.client.users.has(data.id)) return this.client.users.get(data.id);\n    const user = new User(this.client, data);\n    if (cache) this.client.users.set(user.id, user);\n    return user;\n  }\n\n  newChannel(data, guild) {\n    const already = this.client.channels.has(data.id);\n    let channel;\n\n    if (data.type === Constants.ChannelTypes.DM) {\n      channel = new DMChannel(this.client, data);\n    } else if (data.type === Constants.ChannelTypes.GROUP_DM) {\n      channel = new GroupDMChannel(this.client, data);\n    } else {\n      guild = guild || this.client.guilds.get(data.guild_id);\n\n      if (already) {\n        channel = this.client.channels.get(data.id);\n      } else if (guild) {\n        switch (data.type) {\n          case Constants.ChannelTypes.TEXT:\n            channel = new TextChannel(guild, data);\n            break;\n\n          case Constants.ChannelTypes.VOICE:\n            channel = new VoiceChannel(guild, data);\n            break;\n\n          case Constants.ChannelTypes.CATEGORY:\n            channel = new CategoryChannel(guild, data);\n            break;\n\n          case Constants.ChannelTypes.NEWS:\n            channel = new NewsChannel(guild, data);\n            break;\n\n          case Constants.ChannelTypes.STORE:\n            channel = new StoreChannel(guild, data);\n            break;\n        }\n\n        guild.channels.set(channel.id, channel);\n      }\n    }\n\n    if (channel && !already) {\n      if (this.pastReady) this.client.emit(Constants.Events.CHANNEL_CREATE, channel);\n      this.client.channels.set(channel.id, channel);\n      return channel;\n    } else if (already) {\n      return channel;\n    }\n\n    return null;\n  }\n\n  newEmoji(data, guild) {\n    const already = guild.emojis.has(data.id);\n\n    if (data && !already) {\n      let emoji = new Emoji(guild, data);\n      this.client.emit(Constants.Events.GUILD_EMOJI_CREATE, emoji);\n      guild.emojis.set(emoji.id, emoji);\n      return emoji;\n    } else if (already) {\n      return guild.emojis.get(data.id);\n    }\n\n    return null;\n  }\n\n  killEmoji(emoji) {\n    if (!(emoji instanceof Emoji && emoji.guild)) return;\n    this.client.emit(Constants.Events.GUILD_EMOJI_DELETE, emoji);\n    emoji.guild.emojis.delete(emoji.id);\n  }\n\n  killGuild(guild) {\n    const already = this.client.guilds.has(guild.id);\n    this.client.guilds.delete(guild.id);\n    if (already && this.pastReady) this.client.emit(Constants.Events.GUILD_DELETE, guild);\n  }\n\n  killUser(user) {\n    this.client.users.delete(user.id);\n  }\n\n  killChannel(channel) {\n    this.client.channels.delete(channel.id);\n    if (channel instanceof GuildChannel) channel.guild.channels.delete(channel.id);\n  }\n\n  updateGuild(currentGuild, newData) {\n    const oldGuild = Util.cloneObject(currentGuild);\n    currentGuild.setup(newData);\n    if (this.pastReady) this.client.emit(Constants.Events.GUILD_UPDATE, oldGuild, currentGuild);\n  }\n\n  updateChannel(currentChannel, newData) {\n    currentChannel.setup(newData);\n  }\n\n  updateEmoji(currentEmoji, newData) {\n    const oldEmoji = Util.cloneObject(currentEmoji);\n    currentEmoji.setup(newData);\n    this.client.emit(Constants.Events.GUILD_EMOJI_UPDATE, oldEmoji, currentEmoji);\n    return currentEmoji;\n  }\n\n}\n\nmodule.exports = ClientDataManager;","map":null,"metadata":{},"sourceType":"script"}