{"ast":null,"code":"const AbstractHandler = require('./AbstractHandler');\n\nconst Constants = require('../../../../util/Constants');\n\nconst Util = require('../../../../util/Util');\n\nclass VoiceStateUpdateHandler extends AbstractHandler {\n  handle(packet) {\n    const client = this.packetManager.client;\n    const data = packet.d;\n    const guild = client.guilds.get(data.guild_id);\n\n    if (guild) {\n      const member = guild.members.get(data.user_id);\n\n      if (member) {\n        const oldVoiceChannelMember = Util.cloneObject(member);\n\n        if (member.voiceChannel && member.voiceChannel.id !== data.channel_id) {\n          member.voiceChannel.members.delete(oldVoiceChannelMember.id);\n        } // If the member left the voice channel, unset their speaking property\n\n\n        if (!data.channel_id) member.speaking = null;\n\n        if (member.user.id === client.user.id && data.channel_id) {\n          client.emit('self.voiceStateUpdate', data);\n        }\n\n        const newChannel = client.channels.get(data.channel_id);\n\n        if (newChannel) {\n          newChannel.members.set(member.id, member);\n          member.guild.channels.set(data.channel_id, newChannel);\n        }\n\n        member.serverMute = data.mute;\n        member.serverDeaf = data.deaf;\n        member.selfMute = data.self_mute;\n        member.selfDeaf = data.self_deaf;\n        member.voiceSessionID = data.session_id;\n        member.voiceChannelID = data.channel_id;\n        client.emit(Constants.Events.VOICE_STATE_UPDATE, oldVoiceChannelMember, member);\n      }\n    }\n  }\n\n}\n/**\n * Emitted whenever a user changes voice state - e.g. joins/leaves a channel, mutes/unmutes.\n * @event Client#voiceStateUpdate\n * @param {GuildMember} oldMember The member before the voice state update\n * @param {GuildMember} newMember The member after the voice state update\n */\n\n\nmodule.exports = VoiceStateUpdateHandler;","map":null,"metadata":{},"sourceType":"script"}